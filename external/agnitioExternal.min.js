!function(){"use strict";var a=["iOS","Windows"],b=["Sharedoc","Engager"],c={name:"Agnitio External API",version:"1.0.0",platform:"",applicationFamily:"",appInterface:"",initialized:!1,setInitialized:function(a){void 0===a&&(a=!0),this.initialized=a},isInitialized:function(){return this.initialized===!0},getName:function(){return this.name},getVersion:function(){return this.version},getPlatform:function(){return this.platform},setPlatform:function(b){if(a.indexOf(b)===-1)throw"Incorrect platform";this.platform=b},getApplicationFamily:function(){return this.applicationFamily},setApplicationFamily:function(a){if(b.indexOf(a)===-1)throw"Incorrect app family";this.applicationFamily=a},setAppInterface:function(){switch(this.getPlatform()){case"iOS":this.appInterface="ag://",this.setInitialized();break;case"Windows":this.appInterface="http://engager.agnitio.com/",this.setInitialized();break;default:throw"Cannot set interface! No information about platform"}},getAppInterface:function(){return this.appInterface},initCommunication:function(a,b){try{this.setPlatform(b.platform),this.setApplicationFamily(b.applicationFamily),this.setAppInterface(),this.sendConfirmCommunication(a)}catch(a){console.log("Problem during initialization!, "+a)}},markInteractionAsCompleted:function(){return!!this.isInitialized()&&(this.respond("markInteractionCompleted"),!0)},sendConfirmCommunication:function(a){if(!a)throw"Incorrect communication id";var b=this,c="confirmCommunication",d={communicationId:a,agnitioLibInfo:{libName:b.getName(),libVersion:b.getVersion()}};this.respond(c,d)},respond:function(a,b){var c,d=this.prepareLink(a,b);c=document.createElement("IFRAME"),c.setAttribute("src",d),document.body.appendChild(c),c.parentNode.removeChild(c),c=null},prepareLink:function(a,b){var c=this.getAppInterface();return c+=a,b&&(b=this.prepareParameters(b),c=c+"?"+b),c},prepareParameters:function(a){var c,d,b="";for(c in a)b=b+c+"=",d=a[c],"object"==typeof d&&(d=encodeURIComponent(JSON.stringify(d))),b=b+d+"&";return b=b.slice(0,-1)}};window.agRainmaker={initCommunication:function(a,b){return c.initCommunication.call(c,a,b)}},window.agExternal={markInteractionAsCompleted:function(){return c.markInteractionAsCompleted.call(c)},getVersion:function(){return c.getVersion.call(c)},getName:function(){return c.getName.call(c)}}}();