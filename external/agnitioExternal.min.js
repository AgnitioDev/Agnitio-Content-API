!function(){"use strict";const t={IOS:"iOS",WINDOWS:"Windows",WEB:"Web"},i={SHAREDOC:"Sharedoc",ENGAGER:"Engager",MYLIVE:"MyLive"},e="isInitilized",n="isCompleted",o="initCommunication",a={name:"Agnitio External API",version:"1.0.1",platform:"",applicationFamily:"",appInterface:"",initialized:!1,setInitialized:function(t){void 0===t&&(t=!0),this.initialized=t},isWeb:function(){return this.platform===t.WEB},postMessage:function(t,i){window.parent.postMessage({messageKey:t,data:i},"https://mylive.agnitio.com")},isInitialized:function(){return!0===this.initialized},getName:function(){return this.name},getVersion:function(){return this.version},getPlatform:function(){return this.platform},setPlatform:function(i){if(-1===Object.values(t).indexOf(i))throw"Incorrect platform";this.platform=i},getApplicationFamily:function(){return this.applicationFamily},setApplicationFamily:function(t){if(-1===Object.values(i).indexOf(t))throw"Incorrect app family";this.applicationFamily=t},setAppInterface:function(){switch(this.getPlatform()){case"iOS":this.appInterface="ag://",this.setInitialized();break;case"Windows":this.appInterface="http://engager.agnitio.com/",this.setInitialized();break;case"Web":this.appInterface="https://mylive.agnitio.com/",this.setInitialized();break;default:throw"Cannot set interface! No information about platform"}},getAppInterface:function(){return this.appInterface},initCommunication:function(t,i){try{this.setPlatform(i.platform),this.setApplicationFamily(i.applicationFamily),this.setAppInterface(),this.sendConfirmCommunication(t),this.isWeb()&&this.postMessage(e,t)}catch(t){console.log("Problem during initialization!, "+t),this.isWeb()&&this.postMessage(e,t)}},markInteractionAsCompleted:function(){if(this.isInitialized()){const t="markInteractionCompleted";return this.respond(t),this.isWeb()&&this.postMessage(n,t),!0}return!1},sendConfirmCommunication:function(t){if(!t)throw"Incorrect communication id";var i={communicationId:t,agnitioLibInfo:{libName:this.getName(),libVersion:this.getVersion()}};this.respond("confirmCommunication",i)},respond:function(t,i){var e,n=this.prepareLink(t,i);(e=document.createElement("IFRAME")).setAttribute("src",n),document.body.appendChild(e),e.parentNode.removeChild(e),e=null},prepareLink:function(t,i){var e=this.getAppInterface();return e+=t,i&&(e=e+"?"+(i=this.prepareParameters(i))),e},prepareParameters:function(t){var i,e,n="";for(i in t)n=n+i+"=","object"==typeof(e=t[i])&&(e=encodeURIComponent(JSON.stringify(e))),n=n+e+"&";return n=n.slice(0,-1)}};window.addEventListener("message",function(t){if("https://mylive.agnitio.com"!==t.origin)throw"unsupported origin!";if(t.data.messageKey!==o)return void a.postMessage(o,"incorrectMessageKey");const{communicationId:i,clientInfo:e}=t.data;a.initCommunication(i,e)}),window.agRainmaker={initCommunication:function(t,i){return a.initCommunication.call(a,t,i)}},window.agExternal={markInteractionAsCompleted:function(){return a.markInteractionAsCompleted.call(a)},getVersion:function(){return a.getVersion.call(a)},getName:function(){return a.getName.call(a)}}}();